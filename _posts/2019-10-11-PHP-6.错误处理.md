---
layout: post
title: "6.PHPé”™è¯¯å¤„ç†"
date: 2019-10-11 12:26:29 +0800
categories: [PHP]
tags: PHP
comments: 1
---

## é”™è¯¯å¤„ç†
#### é”™è¯¯å¤„ç†
æŒ‡çš„æ˜¯ç³»ç»Ÿï¼ˆæˆ–è€…ç”¨æˆ·ï¼‰åœ¨å¯¹æŸäº›ä»£ç è¿›è¡Œæ‰§è¡Œçš„æ—¶å€™ï¼Œå‘ç°æœ‰é”™è¯¯ï¼Œ
å°±ä¼šé€šè¿‡é”™è¯¯å¤„ç†çš„å½¢å¼å‘ŠçŸ¥ç¨‹åºå‘˜ã€‚

#### é”™è¯¯åˆ†ç±»
1. è¯­æ³•é”™è¯¯ï¼šç”¨æˆ·ä¹¦å†™çš„ä»£ç ä¸ç¬¦åˆPHPçš„è¯­æ³•è§„èŒƒï¼Œè¯­æ³•é”™è¯¯ä¼šå¯¼è‡´ä»£ç åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ä¸é€šè¿‡ï¼Œ
æ‰€ä»¥ä»£ç ä¸ä¼šæ‰§è¡Œï¼ˆParse errorï¼‰
2. è¿è¡Œæ—¶é”™è¯¯ï¼šä»£ç ç¼–è¯‘é€šè¿‡ï¼Œä½†æ˜¯ä»£ç åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¼šå‡ºç°ä¸€äº›æ¡ä»¶ä¸æ»¡è¶³å¯¼è‡´çš„é”™è¯¯ï¼ˆruntime errorï¼‰
3. é€»è¾‘é”™è¯¯ï¼šç¨‹åºå‘˜åœ¨å†™ä»£ç çš„æ—¶å€™ä¸å¤Ÿè§„èŒƒï¼Œå‡ºç°äº†ä¸€äº›é€»è¾‘æ€§çš„é”™è¯¯ï¼Œå¯¼è‡´ä»£ç æ­£å¸¸æ‰§è¡Œï¼Œä½†æ˜¯å¾—ä¸åˆ°æƒ³è¦çš„ç»“æœ
```php
$a = 10;
If($a = 1){		//æœ€å¸¸è§æŠŠæ¯”è¾ƒç¬¦å·å†™æˆèµ‹å€¼ç¬¦å·
	//æ‰§è¡Œä»£ç 
}
```
#### é”™è¯¯ä»£å·
**æ‰€æœ‰çœ‹åˆ°çš„é”™è¯¯ä»£å·åœ¨PHPä¸­éƒ½è¢«å®šä¹‰æˆäº†ç³»ç»Ÿå¸¸é‡ï¼ˆå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼‰**

1. ç³»ç»Ÿé”™è¯¯ï¼š
```php
E_PARSEï¼šç¼–è¯‘é”™è¯¯ï¼Œä»£ç ä¸ä¼šæ‰§è¡Œ
E_ERRORï¼šfatal errorï¼Œè‡´å‘½é”™è¯¯ï¼Œä¼šå¯¼è‡´ä»£ç ä¸èƒ½æ­£ç¡®ç»§ç»­æ‰§è¡Œï¼ˆå‡ºé”™çš„ä½ç½®æ–­æ‰ï¼‰
E_WARNINGï¼šwarningï¼Œè­¦å‘Šé”™è¯¯ï¼Œä¸ä¼šå½±å“ä»£ç æ‰§è¡Œï¼Œä½†æ˜¯å¯èƒ½å¾—åˆ°æ„æƒ³ä¸åˆ°çš„ç»“æœ
E_NOTICEï¼šnoticeï¼Œé€šçŸ¥é”™è¯¯ï¼Œä¸ä¼šå½±å“ä»£ç æ‰§è¡Œ
```
2. ç”¨æˆ·é”™è¯¯ï¼šE_USER_ERROR, E_USER_WARNING, E_USER_NOTICE
ç”¨æˆ·åœ¨ä½¿ç”¨è‡ªå®šä¹‰é”™è¯¯è§¦å‘çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨åˆ°çš„é”™è¯¯ä»£å·ï¼ˆç³»ç»Ÿä¸ä¼šç”¨åˆ°ï¼‰
3. **å…¶ä»–ï¼šE_ALLï¼Œä»£è¡¨ç€æ‰€æœ‰ä»é”™è¯¯ï¼ˆé€šå¸¸åœ¨è¿›è¡Œé”™è¯¯æ§åˆ¶çš„æ—¶å€™ä½¿ç”¨æ¯”è¾ƒå¤šï¼‰ï¼Œ
   å»ºè®®åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼ˆå¼€å‘ç¯å¢ƒï¼‰ä½¿ç”¨**
```php
æ‰€æœ‰ä»¥Eå¼€å¤´çš„é”™è¯¯å¸¸é‡ï¼ˆä»£å·ï¼‰å…¶å®éƒ½æ˜¯ç”±ä¸€ä¸ªå­—èŠ‚å­˜å‚¨ï¼Œç„¶åæ¯ä¸€ç§é”™è¯¯å æ®ä¸€ä¸ªå¯¹åº”çš„ä½ï¼Œå¦‚æœæƒ³è¿›è¡Œä¸€äº›é”™è¯¯çš„æ§åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨ä½è¿ç®—è¿›è¡Œæ“ä½œ
æ’é™¤é€šçŸ¥çº§åˆ«noticeï¼šE_ALL & ~E_NOTICE
åªè¦è­¦å‘Šå’Œé€šçŸ¥ï¼šE_WARNING | E_NOTICE
```

#### é”™è¯¯è§¦å‘
- ç¨‹åºè¿è¡Œæ—¶è§¦å‘ï¼šç³»ç»Ÿè‡ªåŠ¨æ ¹æ®é”™è¯¯å‘ç”Ÿåï¼Œå¯¹æ¯”å¯¹åº”çš„é”™è¯¯ä¿¡æ¯ï¼Œè¾“å‡ºç»™ç”¨æˆ·ï¼šä¸»è¦é’ˆå¯¹ä»£ç çš„è¯­æ³•é”™è¯¯å’Œè¿è¡Œæ—¶é”™è¯¯ã€‚
- äººä¸ºè§¦å‘ï¼šçŸ¥é“æŸäº›é€»è¾‘å¯èƒ½ä¼šå‡ºé”™ï¼Œä»è€Œä½¿ç”¨å¯¹åº”çš„åˆ¤æ–­ä»£ç æ¥è§¦å‘å“åº”çš„é”™è¯¯æç¤º

- trigger_error(é”™è¯¯æç¤º)ï¼šå¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°è¿›è¡Œä¸¥æ ¼æ€§æ§åˆ¶

```php
//PHPé”™è¯¯å¤„ç†

//å¤„ç†è„šæœ¬è®©æµè§ˆå™¨æŒ‰ç…§æŒ‡å®šå­—ç¬¦é›†è§£æçš„æ–¹æ³• âœ¨ å¤„ç†ä¸­æ–‡ä¹±ç é—®é¢˜
header('Content-type:text/html;charset=utf-8');

//é™¤æ³•è¿ç®—
$b = 0;

if($b == 0){
	//äººä¸ºè§¦å‘é”™è¯¯
	trigger_error('é™¤æ•°ä¸èƒ½ä¸º0ï¼');					     //é»˜è®¤ noticeï¼Œä¼šç»§ç»­æ‰§è¡Œ
	trigger_error('é™¤æ•°ä¸èƒ½ä¸º0ï¼',E_USER_ERROR); //é»˜è®¤ errorï¼Œä»£ç ä¸ä¼šæ‰§è¡Œ
}

echo 'hello ';
```

#### é”™è¯¯æ˜¾ç¤ºè®¾ç½®
> é”™è¯¯æ˜¾ç¤ºè®¾ç½®ï¼šå“ªäº›é”™è¯¯è¯¥æ˜¾ç¤ºï¼Œä»¥åŠè¯¥å¦‚ä½•æ˜¾ç¤º ;
åœ¨PHPä¸­ï¼Œå…¶å®æœ‰ä¸¤ç§æ–¹å¼æ¥è®¾ç½®å½“å‰è„šæœ¬çš„é”™è¯¯å¤„ç†

```
1ã€	PHPçš„é…ç½®æ–‡ä»¶ï¼šå…¨å±€é…ç½®ï¼šphp.iniæ–‡ä»¶
display_errors ï¼šæ˜¯å¦æ˜¾ç¤ºé”™è¯¯
error_reporting ï¼šæ˜¾ç¤ºä»€ä¹ˆçº§åˆ«çš„é”™è¯¯
```
```ini
é»˜è®¤é…ç½®
error_reporting = E_ALL
display_errors = On
```

```
2ã€	å¯ä»¥åœ¨è¿è¡Œçš„PHPè„šæœ¬ä¸­å»è®¾ç½®ï¼šåœ¨è„šæœ¬ä¸­å®šä¹‰çš„é…ç½®é¡¹çº§åˆ«æ¯”é…ç½®æ–‡ä»¶é«˜ï¼ˆé€šå¸¸åœ¨å¼€å‘å½“ä¸­éƒ½ä¼šåœ¨ä»£ç ä¸­å»è¿›è¡Œæ§åˆ¶å’Œé…ç½®.
Error_reporting()ï¼šè®¾ç½®å¯¹åº”çš„é”™è¯¯æ˜¾ç¤ºçº§åˆ«
Ini_set(â€˜é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®é¡¹â€™,é…ç½®å€¼)
Ini_set(â€˜error_reportingâ€™,E_ALL);
Ini_set(â€˜display_errorsâ€™,1);
```

#### é”™è¯¯æ—¥å¿—è®¾ç½®
```
åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸ä¼šç›´æ¥è®©é”™è¯¯èµ¤è£¸è£¸çš„å±•ç¤ºç»™ç”¨æˆ·ï¼š
1ã€	ä¸å‹å¥½
2ã€	ä¸å®‰å…¨ï¼šé”™è¯¯ä¼šæš´éœ²ç½‘ç«™å¾ˆå¤šä¿¡æ¯ï¼ˆè·¯å¾„ã€æ–‡ä»¶å.

æ‰€ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸€èˆ¬ä¸æ˜¾ç¤ºé”™è¯¯ï¼ˆé”™è¯¯ä¹Ÿæ¯”è¾ƒå°‘ï¼‰ï¼Œä½†æ˜¯ä¸å¯èƒ½é¿å…ä¼šå‡ºç°é”™è¯¯ï¼ˆæµ‹è¯•çš„æ—¶å€™ä¸ä¼šå‘ç°æ‰€æœ‰çš„é—®é¢˜ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™ä¸å¸Œæœ›çœ‹åˆ°ï¼Œä½†æ˜¯åˆå¸Œæœ›æ•æ‰åˆ°å¯ä»¥è®©åå°ç¨‹åºå‘˜å»ä¿®æ”¹ï¼šéœ€è¦ä¿å­˜åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œéœ€è¦åœ¨PHPé…ç½®æ–‡ä»¶ä¸­æˆ–è€…ä»£ç ä¸­ï¼ˆini_setï¼‰è®¾ç½®å¯¹åº”error_logé…ç½®é¡¹
```
1ã€	å¼€å¯æ—¥å¿—åŠŸèƒ½
```
; Besides displaying errors, PHP can also log errors to locations such as a
; server-specific log, STDERR, or a location specified by the error_log
; directive found below. While errors should not be displayed on productions
; servers they should still be monitored and logging is a great way to do that.
; Default Value: Off
; Development Value: On
; Production Value: On
; http://php.net/log-errors
log_errors = On
```
2ã€æŒ‡å®šè·¯å¾„
```
;windows.show_crt_warning
```

#### è‡ªå®šä¹‰é”™è¯¯å¤„ç†
```
æœ€ç®€å•çš„é”™è¯¯å¤„ç†ï¼štrigger_errors()å‡½æ•°ï¼Œä½†æ˜¯è¯¥å‡½æ•°ä¸ä¼šé˜»æ­¢ç³»ç»ŸæŠ¥é”™

PHPç³»ç»Ÿæä¾›äº†ä¸€ç§ç”¨æˆ·å¤„ç†é”™è¯¯çš„æœºåˆ¶ï¼šç”¨æˆ·è‡ªå®šä¹‰é”™è¯¯å¤„ç†å‡½æ•°ï¼Œç„¶åå°†è¯¥å‡½æ•°å¢åŠ æ“ç³»ç»Ÿé”™è¯¯å¤„ç†çš„å¥æŸ„ä¸­ï¼Œç„¶åç³»ç»Ÿä¼šåœ¨ç¢°åˆ°é”™è¯¯ä¹‹åï¼Œä½¿ç”¨ç”¨æˆ·å®šä¹‰çš„é”™è¯¯å‡½æ•°ã€‚
```
1. å¦‚ä½•å°†ç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°æ”¾åˆ°ç³»ç»Ÿä¸­ï¼Ÿ set_error_handler()
```
mixed set_error_handler( callable $error_handler[, int $error_types = E_ALL | E_STRICT] )

è®¾ç½®ä¸€ä¸ªç”¨æˆ·çš„å‡½æ•°(error_handler)æ¥å¤„ç†è„šæœ¬ä¸­å‡ºç°çš„é”™è¯¯ã€‚
```
âœ¨ <br>
$error_handle ğŸ‘‰ å›è°ƒå‡½æ•°:ç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°

2. è‡ªå®šä¹‰é”™è¯¯å¤„ç†å‡½æ•°ï¼Œç³»ç»Ÿæœ‰è¦æ±‚
![](/files/php/è‡ªå®šä¹‰é”™è¯¯å¤„ç†å‡½æ•°.png)

ä»£ç å®ç°ï¼š

1. è‡ªå®šä¹‰é”™è¯¯å¤„ç†å‡½æ•°ï¼šæ³¨æ„å‚æ•°
```php
//è‡ªå®šä¹‰é”™è¯¯å¤„ç†æœºåˆ¶
header('Content-type:text/html;charset=utf-8');

//è‡ªå®šä¹‰å‡½æ•°
/*
	@param1 $errnoï¼Œæ˜¯ç³»ç»Ÿæä¾›çš„é”™è¯¯ä»£ç ï¼šE_ALLï¼ŒE_NOTICE..
*/
function my_error($errno,$errstr,$errfile,$errline){
	//åˆ¤æ–­ï¼šå½“å‰ä¼šç¢°åˆ°é”™è¯¯æœ‰å“ªäº› ğŸ‘‰ æ’é™¤ç³»ç»Ÿæœ¬äº‹å°±è¦æ’é™¤çš„é”™è¯¯
	if(!(error_reporting() & $errno)){
		return false;
		//error_reportingæ²¡æœ‰å‚æ•°ä»£è¡¨è·å–å½“å‰ç³»ç»Ÿé”™è¯¯å¤„ç†å¯¹åº”çš„çº§åˆ«
	}

	//å¼€å§‹åˆ¤æ–­é”™è¯¯ç±»å‹ ğŸ‘‰ åŒ¹é…é”™è¯¯
	switch($errno){
		case E_ERROR:
		case E_USER_ERROR:
			echo 'fatal error in file ' . $errfile . ' on line ' . $errline . '<br/>';
			echo 'error info ï¼š' . $errstr;
			break;
		case E_WARNING:
		case E_USER_WARNING:
			echo 'Warning in file ' . $errfile . ' on line ' . $errline . '<br/>';
			echo 'error info ï¼š' . $errstr;
			break;
		case E_NOTICE:
		case E_USER_NOTICE:
			echo 'Notice in file ' . $errfile . ' on line ' . $errline . '<br/>';
			echo 'error info ï¼š' . $errstr;
			break;
	}

	return true;
}

//æŠ¥é”™
echo $a;  ğŸ‘‰ åŸæ¥ç³»ç»ŸæŠ¥é”™

//ä¿®æ”¹é”™è¯¯æœºåˆ¶
set_error_handler('my_error');

echo $a;  ğŸ‘‰ ä¿®æ”¹é”™è¯¯æœºåˆ¶å,ä½¿ç”¨è‡ªå®šä¹‰æŠ¥é”™
```
ğŸ
```
Notice: Undefined variable: a in C:\fastwork\Apache24\htdocs\test.php on line 40
Notice in file C:\fastwork\Apache24\htdocs\test.php on line 45
error info ï¼šUndefined variable: a
```

2. æ³¨å†Œè‡ªå®šä¹‰å‡½æ•°ï¼šä¿®æ”¹é”™è¯¯å¤„ç†æœºåˆ¶
```
Notice: Undefined variable: a in C:\fastwork\Apache24\htdocs\test.php on line 40
Notice in file C:\fastwork\Apache24\htdocs\test.php on line 45
error info ï¼šUndefined variable: a
```
å½“å‰å±äºç®€å•è‡ªå®šä¹‰æ¨¡å¼ï¼Œå¦‚æœè¦å¤æ‚ï¼Œå¯ä»¥åœ¨æŸäº›å½±å“ä»£ç åŠŸèƒ½çš„é”™è¯¯å‘ç”Ÿåï¼Œè®©ç”¨æˆ·è·³è½¬åˆ°æŸä¸ªæŒ‡å®šç•Œé¢ã€‚

---
