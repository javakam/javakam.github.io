---
layout: post
title: "11.PHPä¸­MySQLæ‰©å±•"
date: 2019-10-21 09:16:41 +0800
categories: [PHP]
tags: [PHP]
---

* content
{:toc}

### Mysqlæ‰©å±•(åŸºäºPHP7)
PHP é’ˆå¯¹ MySQL æ•°æ®åº“æ“ä½œæä¾›çš„æ‰©å±•ï¼šå…è®¸PHPå½“åšMySQLçš„ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨è¿›è¡Œæ“ä½œã€‚<br>
> PDOæˆ–mysqliéƒ½å¯ä»¥è¿æ¥mysqlï¼Œä½†æ›´æ¨èä½¿ç”¨PDOè¿æ¥æ•°æ®åº“ï¼Œå› ä¸ºPDOæ”¯æŒ12ç§ä¸åŒçš„æ•°æ®åº“é©±åŠ¨ç¨‹åºï¼Œmysqliåªæ”¯æŒmysqlï¼Œè€Œä¸”PDOæ€§èƒ½æ›´é«˜

```
;php.iniä¸­çš„ MySQL æ‰©å±•
extension=mysqli
```
ğŸŒˆPHP7å¯¹æ¯”PHP5çš„MySQLæ“ä½œä¸Šæ”¹åŠ¨å¾ˆå¤§,ä½†æ˜¯ä»æ—§æœ‰è¿¹å¯å¾ªã€æœ‰è§„å¾‹:ğŸŒ°
```php
PHP5:
mysql_query('use examples');
PHP7:
mysqli_query($conn,'use examples');

å¯è§,7ä¸­åœ¨ mysqlå‘½ä»¤åé¢å¤šäº†ä¸ª'i',å¹¶ä¸”ä¼ å‚çš„æ—¶å€™éƒ½è¦ä¼ å…¥ $conn è¿æ¥å¯¹è±¡ , å¦å¤–å¯¹äº
mysqli_num_rows($res) ç­‰å¢åˆ æ”¹æŸ¥ä»¥ä¸‹çš„æ–¹æ³•,åªæ˜¯æŠŠ mysql æ”¹æˆ mysqli å³å¯ã€‚
```
ğŸŒˆMySQL8.0å’ŒPHP7.13 å…¼å®¹æ€§é—®é¢˜
> å®˜æ–¹äººå‘˜è§£é‡ŠğŸ‘‰<https://mysqlserverteam.com/upgrading-to-mysql-8-0-default-authentication-plugin-considerations/> <br>
  caching_sha2_password é—®é¢˜ ğŸ‘‰ <https://blog.csdn.net/maoxinwen1/article/details/88629313> <br>
  æˆæƒé—®é¢˜<https://www.2ita.com/thread-27166-1-1.html>

```php
//è¿æ¥é˜¿é‡Œäº‘CentOSä¸­Dockerå†…çš„MySQL8.0
$conn2=mysqli_connect('116.62.155.140:3306','root','ma1bao2') or die("è¿æ¥å¤±è´¥ ".mysqli_connect_error());
ğŸ
Warning:  mysqli_connect(): The server requested authentication method unknown to the client [caching_sha2_password] in C:\fastwork\Apache24\htdocs\init-mysql.php on line 14
```
è§£å†³æµç¨‹:
1. é…ç½® mysql.cnf é…ç½®é»˜è®¤èº«ä»½éªŒè¯æ’ä»¶

```
[mysqld]
default_authentication_plugin = mysql_native_password
```
2. SELECT Host, User, plugin from user;

```sql
mysql> SELECT Host, User, plugin from user;
+-----------+------------------+-----------------------+
| Host      | User             | plugin                |
+-----------+------------------+-----------------------+
| %         | root             | caching_sha2_password |
| localhost | mysql.infoschema | caching_sha2_password |
| localhost | mysql.session    | caching_sha2_password |
| localhost | mysql.sys        | caching_sha2_password |
| localhost | root             | mysql_native_password |
+-----------+------------------+-----------------------+
```
è¿˜å¾—æ”¹ % , % è¡¨ç¤ºå¤–éƒ¨ç”¨æˆ·è¿æ¥
```sql
ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY '123456';
ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '123456';
FLUSH PRIVILEGES;
```
ğŸ˜­ç»ˆäºæˆåŠŸäº†...ğŸ
```
æ•°æ®æ’å…¥æˆåŠŸ!é˜¿é‡Œäº‘æ•°æ®æ’å…¥æˆåŠŸ!
61
1
```
ğŸŒ´ è¿æ¥æœåŠ¡å™¨ä¸­Dockerå†…çš„MySQL
![è¿æ¥æœåŠ¡å™¨ä¸­Dockerå†…çš„MySQL](/files/php/è¿æ¥æœåŠ¡å™¨ä¸­Dockerå†…çš„MySQL.png)

#### è¿åº“åŸºæœ¬æ“ä½œ
##### 1.è¿æ¥æ•°æ®åº“æœåŠ¡å™¨
> èµ„æº mysql_connect(æœåŠ¡å™¨åœ°å€ï¼Œç”¨æˆ·åï¼Œå¯†ç ) <br>
  ğŸ–php7æ”¹ç”¨ mysqli_connect è¿æ¥æ•°æ®åº“;è‹¥ä»æ—§ä½¿ç”¨ mysql_connect åˆ™æŠ¥é”™:
```html
Fatal error:  Uncaught Error: Call to undefined function mysql_connect() in C:\fastwork\Apache24\htdocs\test.php:7
Stack trace:
#0 {main}
  thrown in C:\fastwork\Apache24\htdocs\test.php on line 7
```
PHPè¿æ¥æ–¹å¼:
1. é¢å‘è¿‡ç¨‹æ–¹å¼
```php
header('Content-type:text/html;charset=utf-8');
echo '<pre>';

//ä¸»æœºåœ°å€ï¼šé»˜è®¤ç«¯å£3306
$servername = "localhost";
$username = "root";
$password = "123456";

// åˆ›å»ºè¿æ¥
$conn = mysqli_connect($servername, $username, $password);
//æˆ–è€…é‡‡ç”¨çŸ­è·¯è¿ç®—æ–¹å¼(https://segmentfault.com/a/1190000002949450) ğŸ‘‡
//$conn=mysqli_connect('127.0.0.1:3306','roo2t','123456') or die("è¿æ¥å¤±è´¥ ".mysqli_connect_error());

// æ£€æµ‹è¿æ¥
if (!$conn) { //ğŸ‘‰ä¹Ÿå¯ä»¥ if (mysqli_connect_error())
    die("è¿æ¥å¤±è´¥: " ); mysqli_connect_error());
}

var_dump($conn);
//å…³é—­è¿æ¥
mysqli_close($conn);
ğŸ
object(mysqli)#1 (19) {
  ["affected_rows"]=>
  int(0)
  ["client_info"]=>
  string(79) "mysqlnd 5.0.12-dev - 20150407 - $Id: 7cc7cc96e675f6d72e5cf0f267f48e167c2abb23 $"
  ["client_version"]=>
  int(50012)
  ["connect_errno"]=>
  int(0)
  ["connect_error"]=>
  NULL
  ["errno"]=>
  int(0)
  ["error"]=>
  string(0) ""
  ["error_list"]=>
  array(0) {
  }
  ["field_count"]=>
  int(0)
  ["host_info"]=>
  string(20) "localhost via TCP/IP"
  ["info"]=>
  NULL
  ["insert_id"]=>
  int(0)
  ["server_info"]=>
  string(6) "8.0.17"
  ["server_version"]=>
  int(80017)
  ["stat"]=>
  string(135) "Uptime: 3074  Threads: 2  Questions: 120  Slow queries: 0  Opens: 306  Flush tables: 3  Open tables: 226  Queries per second avg: 0.039"
  ["sqlstate"]=>
  string(5) "00000"
  ["protocol_version"]=>
  int(10)
  ["thread_id"]=>
  int(48)
  ["warning_count"]=>
  int(0)
}
```
è¿æ¥èµ„æºé»˜è®¤ä¹Ÿæ˜¯è¶…å…¨å±€çš„ï¼Œä»»ä½•åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨è¯¥èµ„æºè¿›è¡Œæ•°æ®åº“çš„å…¶ä»–æ“ä½œ

2. ä½¿ç”¨ PDO è¿æ¥ MySQL

```php
try {
    $conn = new PDO("mysql:host=$servername;", $username, $password);
    echo "è¿æ¥æˆåŠŸ";
}
catch(PDOException $e)
{
    echo "è¿æ¥å¤±è´¥ ".$e->getMessage();
}
//å…³é—­è¿æ¥
$conn = null;
ğŸå¤±è´¥æƒ…å†µ
è¿æ¥å¤±è´¥ SQLSTATE[HY000] [2054] The server requested authentication method unknown to the client
```

3. å®é™…å¼€å‘ä¸­ :
   - æ¨èä½¿ç”¨ PDOè¿æ¥æ–¹å¼ , å› ä¸ºå¯ä»¥è¿æ¥æ›´å¤šçš„æ•°æ®åº“
   - ä½¿ç”¨å‡½æ•° parse_ini_file() è§£æé…ç½®æ–‡ä»¶ config.ini æ¥è·å¾—æ•°æ®åº“è¿æ¥å‚æ•° , å¦‚ä¸‹æ‰€ç¤ºï¼š

```php
//è§£æconfig.iniæ–‡ä»¶
$config = parse_ini_file(realpath(dirname(__FILE__) . '/config/config.ini'));
//å¯¹mysqliç±»è¿›è¡Œå®ä¾‹åŒ–
$conn = new mysqli($config['host'], $config['username'], $config['password'], $config['dbname']);
```

> è¡¥å……ï¼š mysql_connect é»˜è®¤æ˜¯å¯¹ä¸€ä¸ªæœåŠ¡å™¨åªè¿æ¥ä¸€æ¬¡ï¼ˆå¦‚æœå†æ¬¡è¿è¡Œï¼Œè¿”å›çš„æ˜¯åŒä¸€ä¸ªèµ„æºï¼‰ï¼Œä½†æ˜¯å¦‚æœæœ‰éœ€è¦è¿æ¥åŒä¸€ä¸ªèµ„æºä¸¤æ¬¡ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ç¬¬å››ä¸ªå‚æ•°ï¼šTRUE

##### 2.è®¾ç½®è¿æ¥ç¼–ç 
ä¿æŒå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„æ²Ÿé€šé¡ºç•…ï¼šåŒä¸€â€œè¯­è¨€â€ï¼ˆå­—ç¬¦é›†ï¼‰

```php
//php7
mysqli_query($conn, "set character set 'utf8'");//è¯»åº“
mysqli_query($conn,"set names 'utf8'");//å†™åº“
//php5
mysql_query("set character set 'utf8'");//è¯»åº“
mysql_query("set names 'utf8'");//å†™åº“
ğŸŒ°
//è®¾å®šå­—ç¬¦é›†
$res = mysqli_query($conn,"set names 'utf8'");//å†™åº“
//æˆ–è€… $res = mysqli_set_charset($conn,'utf8');
var_dump($res);
ğŸ
bool(true)
```
> æ€ä¹ˆç¡®å®šè¦ä½¿ç”¨ä½•ç§ç¼–ç 
  å®¢æˆ·ç«¯å½“å‰æ‰§è¡Œè„šæœ¬çš„ç•Œé¢æ˜¯ä»€ä¹ˆå­—ç¬¦é›†ï¼Œå°±è®¾å®šæˆä»€ä¹ˆå­—ç¬¦é›†

##### 3.é€‰å®šè¦ä½¿ç”¨çš„æ•°æ®åº“
```php
$res = mysqli_query($conn,'use examples');
//æˆ–è€… $res = mysqli_select_db($conn,'examples');
var_dump($res);
ğŸ
bool(true)//è¡¨ç¤ºè¿æ¥æ•°æ®åº“æˆåŠŸ
```
##### 4.å…³é—­è¿æ¥
```php
$res = mysqli_close($conn);
var_dump($res);
```

#### æ‰§è¡Œå¢åˆ æ”¹æ“ä½œ

1. ç¯å¢ƒå‡†å¤‡:

```sql
create database News charset utf8;

create table n_news(
id int primary key auto_increment,
title varchar(50) not null comment 'æ–°é—»æ ‡é¢˜',
isTop tinyint not null comment 'æ˜¯å¦ç½®é¡¶',
content text comment 'å†…å®¹',
publiser varchar(20) not null comment 'å‘å¸ƒäºº',
pub_time int not null comment 'å‘å¸ƒæ—¶é—´'
)charset utf8;
```

2. åšä¸ªä¸“é—¨è´Ÿè´£æ•°æ®åº“åˆå§‹åŒ–çš„è„šæœ¬ï¼šä¹‹åè¦æ“ä½œæ•°æ®åº“åŒ…å«è¯¥è„šæœ¬å³å¯

```php
header('Content-type:text/html;charset=utf-8');
echo '<pre>';

//è¿æ¥è®¤è¯
$conn=mysqli_connect('127.0.0.1:3306','root','123456') or die("è¿æ¥å¤±è´¥ ".mysqli_connect_error());
//è®¾å®šå­—ç¬¦é›†
mysqli_query($conn,'set names utf8');
//é€‰æ‹©æ•°æ®åº“
mysqli_query($conn,'use News');
```
##### insert æ’å…¥
```php
//å¼•å…¥åˆå§‹æ–‡ä»¶
include_once 'init-mysql.php';

//ç»„ç»‡SQLæŒ‡ä»¤
$pub_time = time();
$sql = "insert into n_news values(null,'11.PHPçš„MySQLæ‰©å±•',1,'MySQLæ‰©å±•......','Javakam',{$pub_time})";

//æ‰§è¡ŒSQLæŒ‡ä»¤
if(mysqli_query($conn,$sql)){
  //æ“ä½œæˆåŠŸï¼šé€šå¸¸æ˜¯è¿”å›è‡ªå¢é•¿IDç»™ç”¨æˆ·
  echo 'æ•°æ®æ’å…¥æˆåŠŸ!';
}else{
  //æ“ä½œå¤±è´¥
  echo 'æ•°æ®æ’å…¥å¤±è´¥ï¼'.mysqli_error($conn);;
}
```

##### delete åˆ é™¤
```php
//ç»„ç»‡SQLæŒ‡ä»¤ï¼šå®é™…åˆ é™¤æ—¶é€šå¸¸ä¹Ÿæ˜¯æ ¹æ®IDè¿›è¡Œåˆ é™¤ï¼Œä½†æ˜¯IDéƒ½æ˜¯ä¼ é€’è¿‡æ¥
$sql = "delete from n_news where id = 5";
```

##### update ä¿®æ”¹
```php
//ç»„ç»‡SQLæŒ‡ä»¤ï¼šå®é™…æ›´æ–°æ—¶é€šå¸¸ä¹Ÿæ˜¯æ ¹æ®IDè¿›è¡Œæ›´æ–°ï¼Œä½†æ˜¯IDéƒ½æ˜¯ä¼ é€’è¿‡æ¥
$sql = "update n_news set content = 'å¥½å—¨å‹' where id = 20";
```

##### åˆ¤æ–­æ‰§è¡Œç»“æœ
1. æ‰§è¡ŒæˆåŠŸï¼Œç»“æœä¸ºtrueï¼Œåªä»£è¡¨SQLæŒ‡ä»¤æ‰§è¡ŒæˆåŠŸ
2. æ‰§è¡Œå¤±è´¥ï¼Œç»“æœä¸ºfalseï¼Œä»£è¡¨SQLæŒ‡ä»¤é”™è¯¯æˆ–è€…æ“ä½œå¯¹è±¡ä¸å­˜åœ¨

##### select æŸ¥è¯¢
1. mysql_query("select ...")
2. å…¶ä»–ç±»ä¼¼æŸ¥è¯¢è¯­å¥ï¼Œæ¯”å¦‚ï¼šshowè¯­å¥ï¼Œdescè¯­å¥

ä»¥ä¸Šä¸¤ç§æƒ…å†µçš„æ€»ç»“ï¼šå‡¡æ˜¯æ‰§è¡Œæ“ä½œå¸Œæœ›æ‹¿åˆ°æ•°æ®åº“è¿”å›çš„æ•°æ®è¿›è¡Œå±•ç¤ºçš„ï¼ˆç»“æœè¿”å›ï¼šæ•°æ®ç»“æœï¼‰

3. æ‰§è¡Œç»“æœçš„å¤„ç†ï¼šæˆåŠŸä¸ºç»“æœé›†ï¼Œå¤±è´¥ä¸ºfalse

æˆåŠŸè¿”å›ç»“æœï¼šSQLæŒ‡ä»¤æ²¡æœ‰é”™è¯¯ï¼Œä½†æ˜¯å¦‚æœæŸ¥è¯¢ç»“æœæœ¬èº«ä¸ºç©ºè¿”å›ä¹Ÿæ˜¯trueï¼ˆç»“æœé›†æ˜¯ä¸€ç§èµ„æºï¼šè½¬æ¢æˆboolæ°¸è¿œä¸ºTRUEï¼‰

```php
include_once 'init-mysql.php';

//ç»„ç»‡SQLæŒ‡ä»¤
$sql = "select * from n_news";

$res=mysqli_query($conn,$sql);
var_dump($res);
ğŸ
object(mysqli_result)#2 (5) {
  ["current_field"]=>
  int(0)
  ["field_count"]=>
  int(6)
  ["lengths"]=>
  NULL
  ["num_rows"]=>
  int(18)
  ["type"]=>
  int(0)
}
```
###### è·å–ç»“æœé›†è¡Œæ•°
mysqli_num_rows('æŸ¥è¯¢ç»“æœé›†åˆ')ï¼šè·å–ç»“æœé›†ä¸­åˆ°åº•æœ‰å¤šå°‘è¡Œè®°å½•
```php
include_once 'init-mysql.php';
//ç»„ç»‡SQLæŒ‡ä»¤
$sql = "select * from n_news";
$res=mysqli_query($conn,$sql);
//è·å–ç»“æœé›†æ•°æ®æ¡æ•°ï¼šå¤šå°‘è¡Œè®°å½•
$rows = mysqli_num_rows($res);
echo $rows;
ğŸ
18
```
###### è§£æç»“æœé›†
å°†ä¸€ç§ç»“æœé›†èµ„æºï¼ˆPHPä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼‰ï¼Œè½¬æ¢æˆä¸€ç§PHPèƒ½å¤Ÿè§£æçš„æ•°æ®æ ¼å¼ï¼šé€šè¿‡ä»ç»“æœé›†ä¸­ï¼ˆç»“æœé›†æŒ‡é’ˆï¼šç±»ä¼¼æ•°ç»„æŒ‡é’ˆï¼‰ï¼ŒæŒ‰ç…§ç»“æœé›†æŒ‡é’ˆæ‰€åœ¨ä½ç½®å–å‡ºå¯¹åº”çš„ä¸€æ¡è®°å½•ï¼ˆä¸€è¡Œï¼‰ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒæ—¶æŒ‡é’ˆä¸‹ç§»â€¦ç›´åˆ°æŒ‡é’ˆç§»å‡ºç»“æœé›†ã€‚
1. mysqli_fetch_assoc()ï¼š è·å–å…³è”æ•°ç»„ï¼Œè¡¨çš„è¡¨å•åå­—ä½œä¸ºæ•°ç»„ä¸‹æ ‡ï¼Œå…ƒç´ å€¼ä½œä¸ºæ•°ç»„å…ƒç´ å€¼

```php
//è§£æç»“æœé›†
$row = mysqli_fetch_assoc($res);
echo '<pre>';
print_r($row);
ğŸ
Array
(
    [id] => 4
    [title] => 11.PHPçš„MySQLæ‰©å±•
    [isTop] => 1
    [content] => MySQLæ‰©å±•......
    [publiser] => Javakam
    [pub_time] => 1571639075
)
```
2. mysql_fetch_row()ï¼š è·å–ç´¢å¼•æ•°ç»„ï¼Œåªè·å–æ•°æ®çš„å€¼ï¼Œç„¶åæ•°ç»„çš„ä¸‹æ ‡ä»0å¼€å§‹è‡ªåŠ¨ç´¢

```php
$row = mysqli_fetch_row($res);
ğŸ
Array
(
    [0] => 4
    [1] => å­¦æ ¡å­¦ä¹ Læ‰©å±•111
    [2] => 1
    [3] => MySQLæ‰©å±•......
    [4] => Javakam
    [5] => 1571639075
)
```
3. mysql_fetch_array()ï¼šè·å–å…³è”æˆ–è€…ç´¢å¼•æ•°ç»„ï¼Œä½†æ˜¯é»˜è®¤æ˜¯åŒæ—¶å­˜åœ¨ï¼šä¸€ä¸ªè®°å½•å–ä¸¤æ¬¡ï¼Œå½¢æˆä¸€ç»„æ˜¯å…³è”æ•°ç»„ï¼Œä¸€ç»„æ˜¯ç´¢å¼•æ•°ç»„ï¼›<br> ä½†æ˜¯å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°æ¥å†³å®šè·å–çš„æ–¹å¼ï¼šMYSQL_ASSOCåªè·å–å…³è”æ•°ç»„ï¼›MYSQL_NUMåªè·å–ç´¢å¼•æ•°ç»„ï¼›MYSQL_BOTHè·å–å…¨éƒ¨ä¸¤ç§ã€‚

```php
//MYSQL_FETCH_ARRAY
$row = mysqli_fetch_array($res);
print_r($row);

//è·å–ä¸¤ç§
$row = mysqli_fetch_array($res,MYSQLI_BOTH);
print_r($row);

//è·å–å…³è”
$row = mysqli_fetch_array($res,MYSQLI_ASSOC);
print_r($row);

//è·å–ç´¢å¼•
$row = mysqli_fetch_array($res,MYSQLI_NUM);
print_r($row);
echo '<pre>';
print_r($row);
ğŸ
Array
(
    [0] => 4
    [id] => 4
    [1] => å­¦æ ¡å­¦ä¹ Læ‰©å±•111
    [title] => å­¦æ ¡å­¦ä¹ Læ‰©å±•111
    [2] => 1
    [isTop] => 1
    [3] => MySQLæ‰©å±•......
    [content] => MySQLæ‰©å±•......
    [4] => Javakam
    [publiser] => Javakam
    [5] => 1571639075
    [pub_time] => 1571639075
)
Array
(
    [0] => 6
    [id] => 6
    [1] => 2312321çš„MySQLæ‰©å±•
    [title] => 2312321çš„MySQLæ‰©å±•
    [2] => 1
    [isTop] => 1
    [3] => MySQLæ‰©å±•......
    [content] => MySQLæ‰©å±•......
    [4] => Javakam
    [publiser] => Javakam
    [5] => 1571639079
    [pub_time] => 1571639079
)
Array
(
    [id] => 7
    [title] => 11.PHPçš„MySQLæ‰©å±•
    [isTop] => 1
    [content] => MySQLæ‰©å±•......
    [publiser] => Javakam
    [pub_time] => 1571639496
)
Array
(
    [0] => 8
    [1] => æ‰“æ’’æ’’å¤š`çš„MySQLæ‰©å±•
    [2] => 1
    [3] => MySQLæ‰©å±•......
    [4] => Javakam
    [5] => 1571639497
)
Array
(
    [0] => 8
    [1] => æ‰“æ’’æ’’å¤š`çš„MySQLæ‰©å±•
    [2] => 1
    [3] => MySQLæ‰©å±•......
    [4] => Javakam
    [5] => 1571639497
)
```
ğŸ– 1.2.3 ä¸‰ç§æ–¹å¼,éƒ½ä¼šä½¿æŒ‡é’ˆä¸‹ç§»,mysqli_fetch_array çš„ç»“æœæ‰€ç¤ºã€‚

é€šå¸¸ç»“æœé›†çš„æ“ä½œï¼šä¸€èˆ¬æ˜¯è·å–é‡Œé¢çš„æ‰€æœ‰ï¼ˆå…¨éƒ¨è®°å½•ï¼‰

#### å…¶ä»–ç›¸å…³å‡½æ•°
##### æœ‰å­—æ®µä¿¡æ¯
1. mysqli_num_fields()ï¼šè·å–ä¸€ä¸ªæŒ‡å®šç»“æœé›†ä¸­æ‰€æœ‰çš„å­—æ®µæ•°

```php
//æŸ¥è¯¢å½“å‰ç»“æœé›†ä¸­æ‰€æœ‰çš„å­—æ®µæ•°é‡ ğŸ‘‰ tableæœ‰å‡ ä¸ªå­—æ®µ
echo mysqli_num_fields($res);
ğŸ
6
```
2. mysqli_fetch_field_direct()ï¼šè·å–ä¸€ä¸ªæŒ‡å®šç»“æœé›†ä¸­æŒ‡å®šä½ç½®å­—æ®µçš„åå­—
php7ä¸­å·²åºŸå¼ƒ mysqli_field_name() ğŸ‘‰ <https://dev.mysql.com/doc/apis-php/en/apis-php-function.mysql-field-name.html>

```php
//æŸ¥è¯¢å½“å‰ç»“æœé›†ä¸­æ‰€æœ‰çš„å­—æ®µæ•°é‡ , é»˜è®¤ä»ç´¢å¼•0å¼€å§‹
print_r(mysqli_fetch_field_direct($res,1));
ğŸ
stdClass Object
(
    [name] => title
    [orgname] => title
    [table] => n_news
    [orgtable] => n_news
    [def] =>
    [db] => news
    [catalog] => def
    [max_length] => 27
    [length] => 150
    [charsetnr] => 33
    [flags] => 4097
    [type] => 253
    [decimals] => 0
)
```
##### æœ‰å…³å‡ºé”™ä¿¡æ¯
1. mysqli_error('æ•°æ®åº“è¿æ¥å¯¹è±¡ $conn')ï¼šè·å–å‡ºé”™å¯¹åº”çš„æç¤ºä¿¡æ¯
2. mysqli_errno('æ•°æ®åº“è¿æ¥å¯¹è±¡ $conn')ï¼šè·å–å‡ºé”™å¯¹åº”çš„é”™è¯¯æç¤ºä»£å·

```php
//é”™è¯¯åˆ¤å®š
if(!$res){
  //ä»£è¡¨ç»“æœä¸ºfalse
  echo 'SQLæŒ‡ä»¤æ‰§è¡Œå‡ºé”™ï¼Œé”™è¯¯ç¼–å·ä¸ºï¼š' . mysqli_errno($conn) . '<br/>';
  echo 'SQLæŒ‡ä»¤æ‰§è¡Œå‡ºé”™ï¼Œé”™è¯¯ä¿¡æ¯æ˜¯ï¼š' . mysqli_error($conn) . '<br/>';
  //ç»ˆæ­¢ä»£ç æ‰§è¡Œ
  exit();
}
```
ğŸ
```
SQLæŒ‡ä»¤æ‰§è¡Œå‡ºé”™ï¼Œé”™è¯¯ç¼–å·ä¸ºï¼š1064
SQLæŒ‡ä»¤æ‰§è¡Œå‡ºé”™ï¼Œé”™è¯¯ä¿¡æ¯æ˜¯ï¼šYou have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'from2 n_news' at line 1
```

##### å…¶ä»–å‡½æ•°
mysql_insert_id($conn) : è·å–ä¸Šæ¬¡æ’å…¥æ“ä½œæ‰€äº§ç”Ÿçš„è‡ªå¢é•¿IDï¼Œå¦‚æœæ²¡æœ‰è‡ªå¢é•¿IDè¿”å›0
```php
//å¼•å…¥åˆå§‹æ–‡ä»¶
include_once 'init-mysql.php';

//ç»„ç»‡SQLæŒ‡ä»¤
$pub_time = time();
$sql = "insert into n_news values(null,'11.PHPçš„MySQLæ‰©å±•',1,'MySQLæ‰©å±•......','Javakam',{$pub_time})";

//æ‰§è¡ŒSQLæŒ‡ä»¤
$res=mysqli_query($conn,$sql);
if($res){
  //æ“ä½œæˆåŠŸï¼šé€šå¸¸æ˜¯è¿”å›è‡ªå¢é•¿IDç»™ç”¨æˆ·
  echo 'æ•°æ®æ’å…¥æˆåŠŸ!';
}else{

  //ä»£è¡¨ç»“æœä¸ºfalse
  echo 'SQLæŒ‡ä»¤æ‰§è¡Œå‡ºé”™ï¼Œé”™è¯¯ç¼–å·ä¸ºï¼š' . mysqli_errno($conn) . '<br/>';
  echo 'SQLæŒ‡ä»¤æ‰§è¡Œå‡ºé”™ï¼Œé”™è¯¯ä¿¡æ¯æ˜¯ï¼š' . mysqli_error($conn) . '<br/>';
  //ç»ˆæ­¢ä»£ç æ‰§è¡Œ
  exit();
}

//è·å–è‡ªå¢é•¿ID
echo mysqli_insert_id($conn);
ğŸ æ¯åˆ·æ–°ä¸€æ¬¡æµè§ˆå™¨,è‡ªå¢1
æ•°æ®æ’å…¥æˆåŠŸ!31
```

















































---
