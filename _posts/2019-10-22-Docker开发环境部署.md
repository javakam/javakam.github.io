---
layout: post
title: "Dockerå¼€å‘ç¯å¢ƒéƒ¨ç½²"
date: 2019-10-22 09:16:14 +0800
categories: [Docker]
tags: [Docker]
comments: 1
---

# Docker

## 1ã€ç®€ä»‹

> **Docker** æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼ŒåŸºäº Go è¯­è¨€ å¹¶éµä» Apache2.0 åè®®å¼€æº ã€‚
**Docker**å¯ä»¥è®©å¼€å‘è€…æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªè½»é‡çº§ã€å¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æœºå™¨ä¸Šå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚å®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œç›¸äº’ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•æ¥å£,æ›´é‡è¦çš„æ˜¯å®¹å™¨æ€§èƒ½å¼€é”€æä½ã€‚
**Docker**æ”¯æŒå°†è½¯ä»¶ç¼–è¯‘æˆä¸€ä¸ªé•œåƒï¼›ç„¶ååœ¨é•œåƒä¸­å„ç§è½¯ä»¶åšå¥½é…ç½®ï¼Œå°†é•œåƒå‘å¸ƒå‡ºå»ï¼Œå…¶ä»–ä½¿ç”¨è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªé•œåƒã€‚è¿è¡Œä¸­çš„è¿™ä¸ªé•œåƒç§°ä¸ºå®¹å™¨ï¼Œå®¹å™¨å¯åŠ¨æ˜¯éå¸¸å¿«é€Ÿçš„ã€‚ç±»ä¼¼windowsé‡Œé¢çš„ghostæ“ä½œç³»ç»Ÿï¼Œå®‰è£…å¥½åä»€ä¹ˆéƒ½æœ‰äº†ï¼›**Docker**æ”¯æŒå°†è½¯ä»¶ç¼–è¯‘æˆä¸€ä¸ªé•œåƒï¼Œç„¶ååœ¨é•œåƒä¸­å„ç§è½¯ä»¶åšå¥½é…ç½®ï¼Œå°†é•œåƒå‘å¸ƒå‡ºå»ï¼Œå…¶ä»–ä½¿ç”¨è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™é•œåƒï¼›è¿è¡Œä¸­çš„è¿™ä¸ªé•œåƒç§°ä¸ºå®¹å™¨ï¼Œå®¹å™¨å¯åŠ¨æ˜¯éå¸¸å¿«é€Ÿçš„ã€‚

![](/files/docker/logo.png)

![](/files/docker/ç®€å•æ¶æ„å›¾.png)

## 2ã€æ ¸å¿ƒæ¦‚å¿µ

dockerä¸»æœº(Host)ï¼šå®‰è£…äº†Dockerç¨‹åºçš„æœºå™¨ï¼ˆDockerç›´æ¥å®‰è£…åœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šï¼‰ï¼›

dockerå®¢æˆ·ç«¯(Client)ï¼šè¿æ¥dockerä¸»æœºè¿›è¡Œæ“ä½œï¼›

dockerä»“åº“(Registry)ï¼šç”¨æ¥ä¿å­˜å„ç§æ‰“åŒ…å¥½çš„è½¯ä»¶é•œåƒï¼›[DockerHub](https://hub.docker.com) æä¾›äº†åºå¤§çš„é•œåƒé›†åˆä¾›ä½¿ç”¨ã€‚

dockeré•œåƒ(Images)ï¼šè½¯ä»¶æ‰“åŒ…å¥½çš„é•œåƒï¼›æ”¾åœ¨dockerä»“åº“ä¸­ï¼›

dockerå®¹å™¨(Container)ï¼šé•œåƒå¯åŠ¨åçš„å®ä¾‹ç§°ä¸ºä¸€ä¸ªå®¹å™¨ï¼›å®¹å™¨æ˜¯ç‹¬ç«‹è¿è¡Œçš„ä¸€ä¸ªæˆ–ä¸€ç»„åº”ç”¨

![](/files/docker/åŸç†å›¾.png)

ä½¿ç”¨Dockerçš„æ­¥éª¤ï¼š

1. å®‰è£…Docker

2. å»Dockerä»“åº“æ‰¾åˆ°è¿™ä¸ªè½¯ä»¶å¯¹åº”çš„é•œåƒï¼›

3. ä½¿ç”¨Dockerè¿è¡Œè¿™ä¸ªé•œåƒï¼Œè¿™ä¸ªé•œåƒå°±ä¼šç”Ÿæˆä¸€ä¸ªDockerå®¹å™¨ï¼›

4. å¯¹å®¹å™¨çš„å¯åŠ¨åœæ­¢å°±æ˜¯å¯¹è½¯ä»¶çš„å¯åŠ¨åœæ­¢ï¼›

## 3ã€å®‰è£…Docker

#### å®‰è£…linuxè™šæ‹Ÿæœº

â€‹	1. VMWareã€VirtualBoxï¼ˆå®‰è£…ï¼‰ï¼›

â€‹	2. å¯¼å…¥è™šæ‹Ÿæœºæ–‡ä»¶centos7-atguigu.ovaï¼›

â€‹	3. åŒå‡»å¯åŠ¨linuxè™šæ‹Ÿæœº;ä½¿ç”¨  root/ 123456ç™»é™†

â€‹	4. ä½¿ç”¨å®¢æˆ·ç«¯è¿æ¥linuxæœåŠ¡å™¨è¿›è¡Œå‘½ä»¤æ“ä½œï¼›

â€‹	5. è®¾ç½®è™šæ‹Ÿæœºç½‘ç»œï¼›

â€‹		æ¡¥æ¥ç½‘ç»œ ==é€‰å¥½ç½‘å¡== æ¥å…¥ç½‘çº¿ï¼›

â€‹	6. è®¾ç½®å¥½ç½‘ç»œä»¥åä½¿ç”¨å‘½ä»¤é‡å¯è™šæ‹Ÿæœºçš„ç½‘ç»œ

```shell
service network restart
```

â€‹	7. æŸ¥çœ‹linuxçš„ipåœ°å€

```shell
ip addr
```

â€‹	8. ä½¿ç”¨å®¢æˆ·ç«¯è¿æ¥linuxï¼›

#### åœ¨linuxè™šæ‹Ÿæœºä¸Šå®‰è£…docker

1. æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬ï¼Œå¿…é¡»æ˜¯3.10åŠä»¥ä¸Š `uname -r`
2. å®‰è£…docker `yum install docker`
3. è¾“å…¥yç¡®è®¤å®‰è£…
4. å¯åŠ¨docker
```
[root@localhost ~]# systemctl start docker
[root@localhost ~]# docker -v
Docker version 1.12.6, build 3e8e77d/1.12.6
```
5. å¼€æœºå¯åŠ¨docker
```
[root@localhost ~]# systemctl enable docker
Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.
```
6. åœæ­¢docker `systemctl stop docker`

## 4ã€Dockerå¸¸ç”¨å‘½ä»¤&æ“ä½œ

### 1. é•œåƒæ“ä½œ

| æ“ä½œ | å‘½ä»¤                                            | è¯´æ˜                                                     |
| ---- | ----------------------------------------------- | -------------------------------------------------------- |
| æ£€ç´¢ | docker  search å…³é”®å­—  egï¼šdocker  search redis | æˆ‘ä»¬ç»å¸¸å»docker  hubä¸Šæ£€ç´¢é•œåƒçš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚é•œåƒçš„TAGã€‚ |
| æ‹‰å– | docker pull é•œåƒå:tag                          | :tagæ˜¯å¯é€‰çš„ï¼Œtagè¡¨ç¤ºæ ‡ç­¾ï¼Œå¤šä¸ºè½¯ä»¶çš„ç‰ˆæœ¬ï¼Œé»˜è®¤æ˜¯latest  |
| åˆ—è¡¨ | docker images                                   | æŸ¥çœ‹æ‰€æœ‰æœ¬åœ°é•œåƒ                                         |
| åˆ é™¤ | docker rmi image-id                             | åˆ é™¤æŒ‡å®šçš„æœ¬åœ°é•œåƒ                                       |

https://hub.docker.com/

### 2. å®¹å™¨æ“ä½œ

è½¯ä»¶é•œåƒï¼ˆQQå®‰è£…ç¨‹åºï¼‰----è¿è¡Œé•œåƒ----äº§ç”Ÿä¸€ä¸ªå®¹å™¨ï¼ˆæ­£åœ¨è¿è¡Œçš„è½¯ä»¶ï¼Œè¿è¡Œçš„QQï¼‰ï¼›

> å®‰è£…æ­¥éª¤

1. æœç´¢é•œåƒ
```
[root@localhost ~]# docker search tomcat
```
2. æ‹‰å–é•œåƒ
```
[root@localhost ~]# docker pull tomcat
```
3. æ ¹æ®é•œåƒå¯åŠ¨å®¹å™¨
```
docker run --name mytomcat -d tomcat:latest
```
4. æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨ `docker ps`
5. åœæ­¢è¿è¡Œä¸­çš„å®¹å™¨ `docker stop  å®¹å™¨çš„id`
6. æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨ `docker ps -a`

7. å¯åŠ¨å®¹å™¨ `docker start å®¹å™¨id`
8. åˆ é™¤ä¸€ä¸ªå®¹å™¨ `docker rm å®¹å™¨id`
9. å¯åŠ¨ä¸€ä¸ªåšäº†ç«¯å£æ˜ å°„çš„tomcat
```
[root@localhost ~]# docker run -d -p 24:8080 tomcat
-dï¼šåå°è¿è¡Œ
-p: å°†ä¸»æœºçš„ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ä¸€ä¸ªç«¯å£    ä¸»æœºç«¯å£:å®¹å™¨å†…éƒ¨çš„ç«¯å£
```
10. ä¸ºäº†æ¼”ç¤ºç®€å•å…³é—­äº†linuxçš„é˜²ç«å¢™
```
service firewalld status ï¼›æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€
service firewalld stopï¼šå…³é—­é˜²ç«å¢™
```
11. æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—
```
docker logs container-name/container-id
```
> æ›´å¤šå‘½ä»¤ğŸ‘‰
<https://docs.docker.com/engine/reference/commandline/docker/>

å¯ä»¥å‚è€ƒæ¯ä¸€ä¸ªé•œåƒçš„æ–‡æ¡£

### 3. å®‰è£…MySQLç¤ºä¾‹
#### æ‹‰å–é•œåƒ
```shell
docker pull mysql
//or
docker pull mysql:8.0.18
```

#### é”™è¯¯çš„å¯åŠ¨

```shell
[root@localhost ~]# docker run --name mysql01 -d mysql
42f09819908bb72dd99ae19e792e0a5d03c48638421fa64cce5f8ba0f40f5846

mysqlé€€å‡ºäº†
[root@localhost ~]# docker ps -a
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                           PORTS               NAMES
42f09819908b        mysql               "docker-entrypoint.sh"   34 seconds ago      Exited (1) 33 seconds ago                            mysql01
538bde63e500        tomcat              "catalina.sh run"        About an hour ago   Exited (143) About an hour ago                       compassionate_
goldstine
c4f1ac60b3fc        tomcat              "catalina.sh run"        About an hour ago   Exited (143) About an hour ago                       lonely_fermi
81ec743a5271        tomcat              "catalina.sh run"        About an hour ago   Exited (143) About an hour ago                       sick_ramanujan


//é”™è¯¯æ—¥å¿—
[root@localhost ~]# docker logs 42f09819908b
error: database is uninitialized and password option is not specified
  You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORDï¼›è¿™ä¸ªä¸‰ä¸ªå‚æ•°å¿…é¡»æŒ‡å®šä¸€ä¸ª

```

#### æ­£ç¡®çš„å¯åŠ¨(æ²¡åšç«¯å£æ˜ å°„)

```shell
[root@localhost ~]# docker run --name mysql01 -e MYSQL_ROOT_PASSWORD=123456 -d mysql
b874c56bec49fb43024b3805ab51e9097da779f2f572c22c695305dedd684c5f
[root@localhost ~]# docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
b874c56bec49        mysql               "docker-entrypoint.sh"   4 seconds ago       Up 3 seconds        3306/tcp            mysql01

```

#### åšäº†ç«¯å£æ˜ å°„(ğŸŒˆç”¨è¿™ä¸ª)
ğŸ–å¦‚æœè¦ä½¿ç”¨dockerå¤–éƒ¨çš„my.cnf(è¿™è´§æœ‰ä¸¤ä¸ª,ç³»ç»Ÿä¸€ä¸ª,dockerå†…ä¸€ä¸ª)åˆ™æ˜¯ç”¨å¦‚ä¸‹å¯åŠ¨æ–¹å¼:
```
1.å°†é…ç½®æ–‡ä»¶ç§»åŠ¨åˆ°æ–°å»ºç›®å½•
[root@ali /]# mv /etc/my.cnf /opt/mysql/my.cnf
mv: cannot move â€˜/etc/my.cnfâ€™ to â€˜/opt/mysql/my.cnfâ€™: No such file or directory
[root@ali /]# cd /opt
[root@ali opt]# ls
[root@ali opt]# mkdir mysql
[root@ali opt]# mv /etc/my.cnf /opt/mysql/my.cnf
[root@ali opt]# cd mysql
[root@ali mysql]# ls
my.cnf

2. -v åé¢çš„å‚æ•°ä¸åŒMySQLç‰ˆæœ¬ä¼šæœ‰å·®å¼‚ ; tagä¸ºç‰ˆæœ¬,latestã€8.0.17 ...  ğŸ˜­æ²¡æˆåŠŸ...
docker run -p 3306:3306 --name mysql01 -v /opt/mysql/my.cnf:/etc/mysql/my.cnf -e MYSQL_ROOT_PASSWORD=ma1bao2  -d mysql
```
ç®€å•ç‚¹:
```shell
[root@localhost ~]# docker run -p 3306:3306 --name mysql01 -e MYSQL_ROOT_PASSWORD=ma1bao2 -d mysql
ad10e4bc5c6a0f61cbad43898de71d366117d120e39db651844c0e73863b9434
[root@localhost ~]# docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES
ad10e4bc5c6a        mysql               "docker-entrypoint.sh"   4 seconds ago       Up 2 seconds        0.0.0.0:3306->3306/tcp   mysql02
```

#### å‡ ä¸ªå…¶ä»–çš„é«˜çº§æ“ä½œ

```
docker run --name mysql01 -v /conf/mysql:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=my-secret-pw  -d mysql/tag
æŠŠä¸»æœºçš„/conf/mysqlæ–‡ä»¶å¤¹æŒ‚è½½åˆ° mysqldockerå®¹å™¨çš„/etc/mysql/conf.dæ–‡ä»¶å¤¹é‡Œé¢
æ”¹mysqlçš„é…ç½®æ–‡ä»¶å°±åªéœ€è¦æŠŠmysqlé…ç½®æ–‡ä»¶æ”¾åœ¨è‡ªå®šä¹‰çš„æ–‡ä»¶å¤¹ä¸‹ï¼ˆ/conf/mysqlï¼‰ , tag ä¸º latest æˆ–å…¶ä»–ç‰ˆæœ¬å·

docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
æŒ‡å®šmysqlçš„ä¸€äº›é…ç½®å‚æ•°
```

### 4. SpringBoot ä¸­é…ç½® MySQL
```xml
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-jdbc</artifactId>
</dependency>

<dependency>
  <groupId>mysql</groupId>
  <artifactId>mysql-connector-java</artifactId>
  <scope>runtime</scope>
</dependency>
```
```yml
spring:
  datasource:
    username: root
    password: 123456
    url: jdbc:mysql://192.168.15.22:3306/jdbc
    driver-class-name: com.mysql.jdbc.Driver
```

### 5. MySQLåœ¨Dockerä¸­çš„ä½¿ç”¨
> å®˜æ–¹æ–‡æ¡£ ğŸ‘‰ <https://github.com/docker-library/docs/tree/master/mysql/>

```
# mysql01 ä¸º docker ps -a æŸ¥è¯¢å‡ºæ¥çš„ NAMES å­—æ®µå
docker exec -it mysql01 bash
# ğŸŒˆæ¨èä½¿ç”¨ CONTAINER ID
docker exec -it 2d581cd2584d /bin/bash
# å°è¯•è¿æ¥mysql,è‹¥å¤±è´¥,åˆ™æŸ¥çœ‹å¹¶å¯åŠ¨mysqlæœåŠ¡
mysql -u root -p


# å¯åŠ¨mysqlæœåŠ¡
systemctl start mysqld
# æŸ¥çœ‹mysqlæœåŠ¡å™¨çš„å¯åŠ¨æƒ…å†µ
ps aux|grep mysql
# è¿ä¸ŠmysqlæœåŠ¡å™¨
mysql -u root -p


ğŸŒˆ ä¿®æ”¹ä¸€äº›é…ç½® (ğŸ”¥ my.cnf è¦åœ¨å®¹å™¨å¤–åšä¿®æ”¹)
# å…ˆä¸‹è½½ vim ç¼–è¾‘å™¨
[root@ali ~]# yum install vim
å¦‚æœæ˜¯ container å†…éƒ¨:
  é¦–å…ˆæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç™»å½•åˆ°containerä¸­
  docker exec -it <container> bash
  ç„¶åè¿è¡Œapt-getå‘½ä»¤æ¥å®‰è£…vi
  apt-get update
  apt-get install vim
# ä¿®æ”¹æœ€å¤§è¿æ¥æ•°å’Œå­—ç¬¦é›†
1.æŸ¥çœ‹å½“å‰å¯¹å¤§è¿æ¥æ•°
show global status like 'Max_used_connections';
æŸ¥çœ‹å­—ç¬¦é›†
show variables like '%char%';
2.åŠ å…¥é…ç½® ğŸ‘‰ [More Topics on Deploying MySQL Server with Docker](https://dev.mysql.com/doc/refman/8.0/en/docker-mysql-more-topics.html#docker-persisting-data-configuration)
å¤–éƒ¨é…ç½®
[root@ali /]# vim /etc/my.cnf
å†…éƒ¨é…ç½®
root@2d581cd2584d:/etc/mysql# vim my.cnf
max_connections=512

```
ğŸŒˆ MySQL8.0 å‚è€ƒé…ç½®
```
[mysqld]
default-set-server=utf8
# å…è®¸æœ€å¤§è¿æ¥æ•°
max_connections=100

[client]
default-character-set=utf8

[mysql]
# è®¾ç½®mysqlå®¢æˆ·ç«¯é»˜è®¤å­—ç¬¦é›†
default-character-set=utf8
```

å‚è€ƒåšå®¢ <https://www.cnblogs.com/wangjunwei/p/11057976.html>

### 6. PHPè¿æ¥è¿œç¨‹ MySQL8
```sql
use mysql;  #ä½¿ç”¨mysqlåº“
ALTER USER 'root'@'localhost' IDENTIFIED BY 'password' PASSWORD EXPIRE NEVER;     #ä¿®æ”¹åŠ å¯†è§„åˆ™
ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'ma1bao2';  #æ›´æ–°å¯†ç ï¼ˆmysql_native_passwordæ¨¡å¼ï¼‰
update user set host='%' where user = 'root';  #è®¾ç½®rootåœ¨ä»»æ„ipå¯ä»¥ä½¿ç”¨ï¼ˆæ”¯æŒè¿œç¨‹è¿æ¥ï¼‰
FLUSH PRIVILEGES;   #åˆ·æ–°æƒé™
quit; #é€€å‡ºæ§åˆ¶å°
```
























---
