---
layout: post
title: "12.æ–°é—»ç®¡ç†é¡¹ç›®"
date: 2019-10-24 16:59:15 +0800
categories: [PHP]
tags: [PHP]
---

# æ–°é—»ç®¡ç†é¡¹ç›®
> bilibiliğŸ‘‰ <https://www.bilibili.com/video/av15525720/?p=26>
  <br>
  é¡¹ç›®æºç  ğŸ‘‰ [PHPæ–°é—»ç®¡ç†é¡¹ç›®æºç .zip](https://download.csdn.net/download/javakam/11922729)

## æ•´ä½“æµç¨‹
- æ·»åŠ æ–°é—»è¡¨å•
  1. æ¥æ”¶æ•°æ®
  2. æ•°æ®éªŒè¯ï¼šåˆæ³•æ€§éªŒè¯ã€‚æ ‡é¢˜ä¸èƒ½ä¸ºç©ºï¼Œå†…å®¹ä¸èƒ½ä¸ºç©º
  3. æç¤ºç”¨æˆ·ï¼ŒåŒæ—¶è®©ç”¨æˆ·é‡æ–°å†æ¥ï¼ˆå›åˆ°æ–°å¢è¡¨å•é¡µé¢ï¼‰
  4. æ•°æ®å…¥åº“

## å…¬å…±æ–‡ä»¶
```php
//1. ä¸­æ–‡å¤„ç†
header('Content-type:text/html;charset=utf-8');
//è¿æ¥è®¤è¯:æœ¬åœ° & é˜¿é‡Œäº‘
//$conn=mysqli_connect('127.0.0.1:3306','root','123456') or die("è¿æ¥å¤±è´¥ ".mysqli_connect_error());
$conn=mysqli_connect('116.62.155.140:3306','root','ma1bao2','News') or die("è¿æ¥å¤±è´¥ ".mysqli_connect_error());


//å°è£…MySQLè¯­æ³•é”™è¯¯æ£€æŸ¥å‡½æ•°å¹¶æ‰§è¡Œ
/*
 * @param $link  æ•°æ®åº“è¿æ¥å¯¹è±¡
 * @param string $sqlï¼Œè¦æ‰§è¡Œçš„SQLæŒ‡ä»¤
 * @return $resï¼Œæ­£ç¡®æ‰§è¡Œå®Œè¿”å›çš„ç»“æœï¼Œå¦‚æœSQLé”™è¯¯ï¼Œç›´æ¥ç»ˆæ­¢
*/
function execSQL($link,$sql){
  //æ‰§è¡ŒSQL
  $res = mysqli_query($link,$sql);

  //å¤„ç†å¯èƒ½å­˜åœ¨çš„é”™è¯¯
  if(!$res){
    echo 'SQLæ‰§è¡Œé”™è¯¯ï¼Œé”™è¯¯ç¼–å·ä¸ºï¼š' . mysqli_errno($link) . '<br/>';
    echo 'SQLæ‰§è¡Œé”™è¯¯ï¼Œé”™è¯¯ä¿¡æ¯ä¸ºï¼š' . mysqli_error($link) . '<br/>';

    //ç»ˆæ­¢é”™è¯¯ç»§ç»­æ‰§è¡Œ
    exit;
  }

  //è¿”å›ç»“æœ
  return $res;
}

//å­—ç¬¦é›†å¤„ç†
execSQL($conn,'set names utf8');
//é€‰æ‹©æ•°æ®åº“
execSQL($conn,'use News');
//mysqli_close($conn);
```

## æ·»åŠ å†…å®¹
```php
header('Content-type:text/html;charset=utf-8');
echo '<pre>';

//1. æ¥æ”¶æ•°æ®
//æ¥å—ç”¨æˆ·æäº¤æ•°æ®
var_dump($_POST);

$title=isset($_POST['title'])?trim($_POST['title']):'';		//title æ˜¯å­—ç¬¦ä¸²(é‡è¦)
$isTop=isset($_POST['isTop'])?(integer)$_POST['isTop']:2;	//æ•°å­—éœ€æ±‚,è€Œä¸”ä¸é‡è¦
$publisher=isset($_POST['publisher'])?trim($_POST['publisher']):'ä½šå';
$content=isset($_POST['content'])?trim($_POST['content']):'';//trimé€šå¸¸é’ˆå¯¹å­—ç¬¦ä¸²
//echo $title;

//2. æ•°æ®éªŒè¯ï¼šåˆæ³•æ€§éªŒè¯ã€‚æ ‡é¢˜ä¸èƒ½ä¸ºç©ºï¼Œå†…å®¹ä¸èƒ½ä¸ºç©º
//3. æç¤ºç”¨æˆ·ï¼ŒåŒæ—¶è®©ç”¨æˆ·é‡æ–°å†æ¥ï¼ˆå›åˆ°æ–°å¢è¡¨å•é¡µé¢ï¼‰
if(empty($title)||empty($content)){
  //æç¤ºåŒæ—¶å›åˆ°æäº¤é¡µ
  //ğŸ– header ä¹‹å‰ä¸èƒ½æœ‰ echo ç­‰è¾“å‡º,ä½†ä¸ä¼šå½±å“åé¢çš„ä»£ç æ‰§è¡Œ
  //ğŸ– url å¼€å‘ä¸­åº”ä½¿ç”¨ç»å¯¹è·¯å¾„
  header('Refresh:3;url=news_add.html');	//headerå‰ä¸èƒ½æœ‰è¾“å‡ºï¼Œheaderï¼šrefreshä¸ä¼šé˜»æ­¢è„šæœ¬æ‰§è¡Œ

  //æ ‡é¢˜å’Œå†…å®¹è‡³å°‘æœ‰ä¸€ä¸ªä¸ºç©º
  //echo 'æ ‡é¢˜å’Œå†…å®¹éƒ½ä¸èƒ½ä¸ºç©ºï¼';

  //é˜»æ­¢è„šæœ¬ç»§ç»­æ‰§è¡Œ
  exit('æ ‡é¢˜å’Œå†…å®¹éƒ½ä¸èƒ½ä¸ºç©ºï¼');
}

//4. æ•°æ®å…¥åº“
include_once 'my_public.php';

$time=time();
$sql="insert into n_news values(null,'{$title}',$isTop,'{$content}','{$publisher}',$time)";

$insert_id = execSQL($conn,$sql);

//4. æç¤ºç”¨æˆ·æ“ä½œç»“æœï¼Œå¹¶è·³è½¬åˆ°åˆ—è¡¨é¡µï¼ˆè·³è½¬åˆ°è¯¦æƒ…é¡µï¼‰
//æˆåŠŸæ“ä½œ,æç¤ºåŒæ—¶å»åˆ°åˆ—è¡¨é¡µ
header('Refresh:3;url=my_news.php');
echo $title . ' å¢åŠ æˆåŠŸï¼';
```

## æ–°é—»åˆ—è¡¨
```php
//1. è·å–æ‰€æœ‰æ–°é—»å†…å®¹å¹¶æ˜¾ç¤º
//æ“ä½œæ•°æ®åº“è·å–æ•°æ®
include_once 'my_public.php';
//ç»„ç»‡SQLè·å–æ‰€æœ‰æ–°é—»ä¿¡æ¯
$sql = "select * from n_news";
//æ‰§è¡Œ
$res = execSQL($conn,$sql);				//æ‹¿åˆ°ç»“æœé›†


//2. ä»ç»“æœé›†ä¸­å–å‡ºæ‰€æœ‰çš„è®°å½•ï¼šä¸€æ¬¡å–ä¸€æ¡ï¼Œä¸€æ¡ä¸€ä¸ªæ•°ç»„ï¼›ç„¶åå°†æ‰€æœ‰çš„è®°å½•æ”¾åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼šå½¢æˆä¸€ä¸ªå…¸å‹çš„äºŒç»´æ•°ç»„
//å¾ªç¯éå†æ‰€æœ‰ç»“æœ
$news = array();							//ä¿å­˜å–å‡ºçš„è®°å½•ï¼ˆæ•°ç»„ï¼‰

//æ–¹æ¡ˆ1ï¼šè·å–ç»“æœé›†ä¸­è®°å½•æ•°ï¼Œç„¶åforå¾ªç¯
//ğŸ– mysqli_num_fields ä¼šé€ æˆæŒ‡é’ˆä¸‹ç§»,å¯¼è‡´åªèƒ½å–å‡ºä¸€åŠçš„ç»“æœ
/*$num = mysqli_num_fields($res);
echo $num.'<br>';
for($i = 0;$i < $num;$i++){
  //ğŸ– $news[] è‡ªå¢
  $news[] = mysqli_fetch_assoc($res);
}
*/

//æ–¹æ¡ˆ2ï¼šåˆ©ç”¨whileå¾ªç¯ï¼Œæ¯æ¬¡å–åˆ°æ•°æ®ä¹‹ååˆ¤æ–­ä¿å­˜æ•°æ®çš„ç»“æœï¼Œåªè¦ç»“æœä¸ä¸ºfalseï¼Œé‚£ä¹ˆä¸€ç›´å–
while($row = mysqli_fetch_assoc($res)){
  $news[] = $row;
}
//echo '<pre>';
//print_r($news);

//3. ä¸€ä¸ªå·²ç»åšå¥½çš„HTMLæ¨¡æ¿èƒ½å¤Ÿæ˜¾ç¤ºæ•°æ®ï¼šå‰ç«¯
//åŒ…å«æ˜¾ç¤ºæ¨¡æ¿ï¼ˆHTMLï¼‰
include_once 'news.html';

//4. PHPæƒ³åŠæ³•å°†æ•°æ®åœ¨HTMLä¸­æ˜¾ç¤ºï¼ˆäºŒè€…ç»“åˆï¼‰ï¼šPHPåŒ…å«HTML
//ä¿®æ”¹ news.html
```
ç”¨äºæ˜¾ç¤ºçš„ news.html
```html
<?php foreach($news as $k => $new):?>
  <tr>
    <td><?php echo $k + 1;?></td>
    <td><?php echo $new['title'];?></td>
    <td><?php echo date('Yå¹´mæœˆdæ—¥ Hæ—¶iåˆ†sç§’',$new['pub_time']);?></td>
    <td><?php echo $new['publiser']?></td>
    <td><?php echo $new['isTop'] == 1 ? 'æ˜¯' : 'å¦';?></td>
    <td style="text-align:center;">
      <a href="news_edit.php?id=<?php echo $new['id'];?>">ä¿®æ”¹</a>&nbsp;|                
      <a href="news_delete.php?id=<?php echo $new['id'];?>" onclick="return confirm('æ˜¯å¦ç¡®å®šåˆ é™¤å½“å‰æ–°é—»ï¼Ÿ');">åˆ é™¤</a>&nbsp;    
    </td>
  </tr>
<?php endforeach;?>
```
![æ•ˆæœ](/files/php/news.htmlæ•ˆæœ.png)

> æ³¨æ„ç»†èŠ‚ï¼š
  1. æ•°æ®çš„æ˜¾ç¤ºè¦é€šè¿‡å¾ªç¯éå†è¾“å‡ºï¼šéœ€è¦æ˜ç¡®PHPæ˜¯å¦‚ä½•ä¿å­˜æ•°æ®
  2. æ•°æ®çš„æ ¼å¼éœ€è¦æŒ‰ç…§éœ€æ±‚æ¥æ˜¾ç¤ºï¼šåˆ—è¡¨ã€æ—¶é—´ã€æ˜¯å¦ç½®é¡¶

## åˆ é™¤æ–°é—»
åˆ é™¤æŒ‰é’®
```html
<a href="my_delete.php?id=<?php echo $new['id'];?>" onclick="return confirm('æ˜¯å¦ç¡®å®šåˆ é™¤å½“å‰æ–°é—»ï¼Ÿ');">åˆ é™¤</a>&nbsp;    
```
```php
//æ–°é—»ç®¡ç†ï¼šåˆ é™¤æŒ‡å®šæ–°é—»
header('Content-type:text/html;charset=utf-8');

//æ¥æ”¶è¦åˆ é™¤çš„æ–°é—»ID
$id = isset($_GET['id']) ? (integer)$_GET['id'] : 0;	//0ä¸ä¼šå­˜åœ¨
if($id == 0) {
  header('Refresh:3;url=news.php');
  echo 'å½“å‰è¦åˆ é™¤çš„æ–°é—»ä¸å­˜åœ¨ï¼';
  exit;
}

//åˆ é™¤æ•°æ®
include_once 'my_public.php';

//ç»„ç»‡SQLå¹¶æ‰§è¡Œ
execSQL($conn,'delete from n_news where id = ' . $id);

//åˆ é™¤åæ›´æ–°é¡µé¢
//æ–¹æ¡ˆä¸€
header('Refresh:0;url=my_news.php');
//echo 'å½“å‰æ–°é—»åˆ é™¤æˆåŠŸï¼';

//æ–¹æ¡ˆäºŒ ğŸŒˆæ•ˆæœæ›´å¥½,é¡µé¢ä¸ä¼šé‡æ–°åˆ·æ–°
/*
$res = execSQL($conn,"select * from n_news");				//æ‹¿åˆ°ç»“æœé›†
$news = array();
while($row = mysqli_fetch_assoc($res)){
  $news[] = $row;
}
include_once 'news.html';
*/
```

## ä¿®æ”¹æ–°é—»
```html
<!-- ğŸ–ğŸ–åˆ«å¿˜äº†ä¼ ID -->
<input type="hidden" name="id" value="<?php echo $update['id'];?>"/>
<!-- å•é€‰ -->
<td width="10%">
  <input type="radio" name="isTop" <?php echo isset($update['isTop'])&&$update['isTop']==1?'checked="checked"':"";?> value="1"/>æ˜¯
  <input type="radio" name="isTop" <?php echo isset($update['isTop'])&&$update['isTop']==0?'checked="checked"':"";?> value="0"/>å¦
</td>
```
æ‰¾åˆ°æŒ‡å®šidçš„å¯¹è±¡,è·³è½¬åˆ°ç¼–è¾‘é¡µ(edit.html)è¿›è¡Œä¿®æ”¹ , ==**è¿™é‡Œä¸èƒ½ç”¨ add.html å–ä»£**==
```php
//æ–°é—»ç®¡ç†ï¼šä¿®æ”¹æŒ‡å®šæ–°é—»-æ‰¾åˆ°æŒ‡å®šidçš„å¯¹è±¡,è·³è½¬åˆ°ç¼–è¾‘é¡µ
//ğŸ–ç¼–è¾‘é¡µä¸åŒäºæ·»åŠ é¡µé¢...ä¸å¤ªçµæ´»
header('Content-type:text/html;charset=utf-8');

$id=isset($_GET['id'])==true?$_GET['id']:-1;
if($id==-1){
	header('Refresh:3;url=my_news.php');
	echo 'å½“å‰è¦ä¿®æ”¹çš„æ–°é—»ä¸å­˜åœ¨ï¼';
	exit;
}

//è·å–å½“å‰IDå¯¹åº”çš„æ–°é—»ä¿¡æ¯
include_once 'my_public.php';
$res=execSQL($conn,"select * from n_news where id = ".$id);
$update= mysqli_fetch_assoc($res);

//print_r($update);
include_once 'news_edit.html';
```
> mysqli_fetch_assoc() ä»ç»“æœé›†ä¸­å–å‡ºä¸€è¡Œä½œä¸ºå…³è”æ•°ç»„ ğŸ‘‰ <https://www.runoob.com/php/func-mysqli-fetch-assoc.html>

å†™å…¥æ•°æ®åº“:
```php
//æ–°é—»ç®¡ç†ï¼šä¿®æ”¹æŒ‡å®šæ–°é—»
header('Content-type:text/html;charset=utf-8');

//æ¥æ”¶æ•°æ®å¹¶éªŒè¯
$id = isset($_POST['id']) ? intval($_POST['id']) : 0;
$title = isset($_POST['title']) ? trim($_POST['title']) : '';	//titleæ˜¯å­—ç¬¦ä¸²ï¼ˆé‡è¦ï¼‰
$isTop = isset($_POST['isTop']) ? intval($_POST['isTop']) : 0 ;	//æ•°å­—éœ€æ±‚ï¼Œè€Œä¸”ä¸é‡è¦
$publiser = isset($_POST['publisher']) ? trim($_POST['publisher']) : '';
$content = isset($_POST['content']) ? trim($_POST['content']) : '';

//æ•°æ®éªŒè¯ï¼šæ ‡é¢˜å’Œå†…å®¹å‡ä¸èƒ½ä¸ºç©º
if(empty($title) || empty($content)){
  //æç¤ºåŒæ—¶å›åˆ°æäº¤é¡µ
  header('Refresh:3;url=my_news.php');	//headerå‰ä¸èƒ½æœ‰è¾“å‡ºï¼Œheaderï¼šrefreshä¸ä¼šé˜»æ­¢è„šæœ¬æ‰§è¡Œ

  //æ ‡é¢˜å’Œå†…å®¹è‡³å°‘æœ‰ä¸€ä¸ªä¸ºç©º//é˜»æ­¢è„šæœ¬ç»§ç»­æ‰§è¡Œ
  exit('æ ‡é¢˜å’Œå†…å®¹éƒ½ä¸èƒ½ä¸ºç©ºï¼');
}

//ç»„ç»‡SQLæ›´æ–°åˆ°æ•°æ®åº“
include_once 'my_public.php';
$sql = "update n_news set title = '{$title}',isTop = {$isTop} ,publiser='{$publiser}' ,content='{$content}' where id = {$id}";
$res = execSQL($conn,$sql);

//æç¤ºæˆåŠŸ
header('Refresh:0;url=my_news.php');
//echo 'å½“å‰æ–°é—»æ›´æ–°æˆåŠŸï¼';
```

## æœç´¢æ–°é—»
```php
//æ–°é—»ç®¡ç†ï¼šåˆ é™¤æŒ‡å®šæ–°é—»
header('Content-type:text/html;charset=utf-8');


//è·å–å…³é”®å­—,è¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢
$keywords=$_POST['title'];

include_once 'my_public.php';
//ç»„ç»‡SQLå¹¶æ‰§è¡Œ
$res=execSQL($conn,"select * from n_news where title like '%$keywords%' ");

$news=array();

while($row=mysqli_fetch_assoc($res)){
  $news[]= $row ;
}

include_once 'news.html';
```
æ–°é—»å±•ç¤ºé¡µ(news.html):
```html
<form class="form-inline definewidth m20" action="my_search.php" method="post">
    æ ‡é¢˜ï¼š<input name="title" class="abc input-default" value="<?php echo isset($keywords)?$keywords:"";?>"></input>&nbsp;&nbsp;
    <button type="submit" class="btn btn-primary" >æŸ¥è¯¢</button>&nbsp;&nbsp;
    <!--
    <button type="button" class="btn btn-primary" onclick="location='news_add.html'">æ·»åŠ </button>&nbsp;&nbsp;
    -->
    <button type="button" class="btn btn-primary" onclick="javascript:window.open('news_add.html')">æ·»åŠ </button>&nbsp;&nbsp;
</form>
```
---
